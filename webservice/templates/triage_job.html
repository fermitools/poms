{%extends "layout.html" %}

{%block title%}
    <title>POMS Job Triage</title>
{%endblock%}

{%block breadcrumbs%}
    <div class="item">
       Dashboard  <!--label of current location on mobile-->
    </div>
    <div class="item">
      Job Triage <!--label of current location on mobile-->
    </div>
{%endblock%}






{%block header%}
<h1 class="ui header">
         Job Triage
                    
          <div class="sub header">
              triage your jobs
         </div>
</h1>
{%endblock%}




{%block subheader%}
<h2 class="ui dividing header">Job Triage:</h2>
{%endblock%}



{%block content %}






<table class="ui celled table">
  <thead>
    <tr>
      <th>Status</th>
      <th>Host Site</th>
      <th>Node Name</th>
      <th>CPU</th>
      <th>Jobsub_Job_ID</th>
      <th>Task ID</th>
      <th>Usr Exe Exit Code</th>
      <th>Updated</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td {% if job_info.Job.status == "Completed" %} class="positive">  <i class="icon checkmark"></i>  {% else %} >  {% endif %}      {{job_info.Job.status}}</td>
      <td>{{job_info.Job.host_site}}</td>
      <td>{{job_info.Job.node_name}}</td>
      <td>{{job_info.Job.cpu_type}}</td>
      <td>{{job_info.Job.jobsub_job_id}}</td>
     <!-- <td><a href="/poms/task_info?task_id={{job_info.Job.task_id}}">{{job_info.Job.task_id}}</a></td> -->
      <td>{{job_info.Job.task_id}}</td>
      <td>{{job_info.Job.user_exe_exit_code}}</td>
      <td>{{job_info.Job.updated}}</td>
    </tr>


  </tbody>
</table>



{% if job_info.Task.project %}
<h4 class="ui horizontal divider header">
      <i class="linkify icon"></i>
      SAM Project
</h4>
<a target="_blank" href="http://samweb.fnal.gov:8480/station_monitor/{{job_info.Campaign.experiment}}/stations/{{job_info.Campaign.experiment}}/projects/{{job_info.Task.project}}">http://samweb.fnal.gov:8480/station_monitor/{{job_info.Campaign.experiment}}/stations/{{job_info.Campaign.experiment}}/projects/{{job_info.Task.project}}</a>
{% endif %}




<!--<h2 class="ui dividing header">Logs:</h2>-->

<h4 class="ui horizontal divider header">
      <i class="file outline icon"></i>
      Logs
</h4>

<button onclick="location.href='/poms/triage_job?job_id={{job_id}}&force_reload=True';" class="ui button">Refetch &nbsp;&nbsp;&nbsp;<i class="refresh icon"></i></button>
<br/>
<br/>



{% set jobsub_job_id_digits = job_info.Job.jobsub_job_id.split('@')[0] %}



{% for item in job_file_list %}

{% if item.find(jobsub_job_id_digits) > -1 %}
<mark> <a href="/poms/job_file_contents?job_id={{job_id}}&file={{item}}">{{ item }}</a> </mark>
<br/>
{% else %}
<a href="/poms/job_file_contents?job_id={{job_id}}&file={{item}}">{{ item }}</a>
<br/>
{% endif %}


{% endfor %}














<!--<h2 class="ui dividing header">General Job Info:</h2>-->

<h4 class="ui horizontal divider header">
      <i class="bar chart icon"></i>
      General Specifications
</h4>

<table class="ui definition table">
    <tbody>
      <tr>
        <td class="three wide">Experiment</td>
        <td>
          <p>{{job_info.Campaign.experiment}}</p>
        </td>
      </tr>
      
      <tr>
        <td>Campaign</td>
        <td>
          <p>{{job_info.Campaign.name}}</p>
        </td>
      </tr>
      <tr>
        <td>Command Executed</td>
        <td>
          <p>{{job_info.Task.command_executed}}</p>
        </td>
      </tr>
      <tr>
        <td>Task Def Name</td>
        <td>
          <p>{{job_info.TaskDefinition.name}}</p>
        </td>
      </tr>
      <tr>
        <td>Task Status</td>
        <td>
          <p>{{job_info.Task.status}}</p>
        </td>
      </tr>
      <tr>
        <td>VO Role</td>
        <td>
          <p>{{job_info.Campaign.vo_role}}</p>
        </td>
      </tr>
    </tbody>
  </table>






<h4 class="ui horizontal divider header">
      <i class="history icon"></i>
      History
</h4>










<table class="ui very basic collapsing celled table">
        <tbody>
          <tr>
            <td class="six wide">Event</td>
            <td class="six wide">Timestamp</td>
          </tr>
          {% for item in job_history %}
          <tr>
            <td><code>{{item.status}}</code></td>
            <td>{{item.created}}</td>
          </tr>
          {% endfor %}
        </tbody>
</table>






{%endblock%}

