{%extends "layout.html" %}


{%block title%}
<title>POMS Workflow Editor</title>
<script src="{{pomspath}}/static/js/gui_editor_3.js"></script>
<script src="{{pomspath}}/static/js/json_field_editor.js"></script>
<link rel="stylesheet" type="text/css" href="{{pomspath}}/static/css/gui_editor_3.css">
<link rel="stylesheet" type="text/css" href="{{pomspath}}/static/css/json_field_editor.css">
{%endblock%}

{%block bodytags%} onload="main()" {%endblock%}

{%block header%}
<h1 class="ui header">
          Workflow Editor for {{campaign}} {%include 'help_button.html'%}

          <div class="sub header">
               Edit whole workflow
          </div>
</h1>
{%endblock%}

{%block subheader%}
&nbsp;
{%endblock%}

{%block content %}

<!-- <div id="outer_gui_editor_frame" style="width:100%; height: 40em; border: 1px solid grey; padding: 1em; overflow-x:scroll; overflow-y: scroll"> -->
<div id="outer_gui_editor_frame">
</div>

<script type="text/javascript">

function main() {
   var args = mwm_utils.getSearchParams()
   var base = mwm_utils.getBaseURL()
   console.log(["args:", args, "base:", base ])
   if (args['campaign'] != undefined) {
       var url;
       if (args['campaign'].indexOf('samples%2F') == 0) {
          url = base + '/static/' + args['campaign'].replace('%2F','/')
       } else {
          url = base +'/campaign_deps_ini?tag=' + args['campaign']
       }
       $.ajax( {
          url: url
       }).done( function(data) {
          var ge = new gui_editor("outer_gui_editor_frame");
          var args = mwm_utils.getSearchParams();
          if ('clone' in args && 'Clone' == args['clone']) {
              ge.set_state_clone(data, args['from'], args['to'],'{{session_experiment}}','{{session_role}}');
          } else {
              ge.set_state(data);
          }
       })
   }
}

</script>

{%endblock%}

{%block final%}

{%endblock%}
