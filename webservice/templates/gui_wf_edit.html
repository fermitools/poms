{%extends "layout.html" %}


{%block title%}
<title>POMS Workflow Editor</title>
<script src="{{pomspath}}/static/js/gui_editor_3.js"></script>
<script src="{{pomspath}}/static/js/json_field_editor.js"></script>
<link rel="stylesheet" type="text/css" href="{{pomspath}}/static/css/gui_editor_3.css">
<link rel="stylesheet" type="text/css" href="{{pomspath}}/static/css/json_field_editor.css">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css">

<style type="text/css">
        #outer_gui_editor_frame {
            width: 1000px;
            height: 600px;
            border: 1px solid lightgray;
        }

        #mydefaults, #myjobtypes {
            width: 1000px;
            height: 100px;
            border: 1px solid lightgray;
        }
</style>

{%endblock%}

{%block bodytags%} onload="main()" {%endblock%}

{%block header%}
<h1 class="ui header">
    Workflow Editor for {{campaign}} {%include 'help_button.html'%}

    <div class="sub header">
        Edit whole workflow
    </div>
</h1>
{%endblock%}

{%block subheader%}
&nbsp;
{%endblock%}

{%block content %}

<!-- <div id="outer_gui_editor_frame" style="width:100%; height: 40em; border: 1px solid grey; padding: 1em; overflow-x:scroll; overflow-y: scroll"> -->
<h3>Campaign Default Values</h3>
<div id="mydefaults" oncontextmenu='return false;' contextmenu=""></div>
<h3>Campaign Stages</h3>
<div id="outer_gui_editor_frame" oncontextmenu='return false;' contextmenu=""></div>
<h3>Campaign Login/Setup and Jobtypes</h3>
<div id="myjobtypes" oncontextmenu='return false;' contextmenu=""></div>
<pre id="eventSpan"></pre>

<script type="text/javascript">

function main() {
   var args = mwm_utils.getSearchParams()
   var base = mwm_utils.getBaseURL()
   console.log(["args:", args, "base:", base ])
   if (args['campaign'] != undefined) {
       var url;
       if (args['campaign'].indexOf('samples%2F') == 0) {
          url = base + '/static/' + args['campaign'].replace('%2F','/')
       } else {
          url = base +'/campaign_deps_ini?tag=' + args['campaign']
       }
       $.ajax( {
          url: url
       }).done( function(data) {
          var ge = new gui_editor("outer_gui_editor_frame");
          var args = mwm_utils.getSearchParams();
          if ('clone' in args && 'Clone' == args['clone']) {
              ge.set_state_clone(data, args['from'], args['to'],'{{session_experiment}}','{{session_role}}');
          } else {
              ge.set_state(data);
          }
       })
   }
}

</script>

{%endblock%}

{%block final%}

{%endblock%}
