{%extends "layout.html"%}

{%block title%}
POMS

{%endblock%}

<style type="text/css">
  div.scrollable {
  width: 100%;
  overflow-x: scroll;
  }
  div.scrollable table {
  width: 300%;
  }
</style>

{%block header%}
    Experiment Authorization{%include 'help_button.html'%}
{%endblock%}

{%block subheader%}
{%endblock%}

{%block content%}

<script type="text/javascript">
function pop_confirm_modal() {
    mod_form = $("#confirm_modal").modal('show');
}

function submit_exp_form() {
  document.getElementById("exp_form").submit();
}

function pop_add_experiment_modal() {
    mod_form = $("#add_experiment_modal").modal('show');
}

function pop_experiment_users_modal(experiment) {

    var formdata = {'experiment': experiment};
    $.ajax({
            url: "{{pomspath}}/experiment_members",
            type: 'GET',
            data: formdata,
            success: function(trows){
              $("#table_row_experiment_users_modal").html(trows);
              $("#header_experiment_users_modal").text("Experimenters List: " + experiment);
              mod_form = $("#experiment_users_modal").modal('show');
            }
    });

}

</script>

<div class="ui {{ 'disabled' if (not current_experimenter.is_root()) }} teal button" onclick="pop_add_experiment_modal()" >Add Experiment</div>
<div class="ui hidden divider"></div>
<form id="exp_form" class="ui form" action="experiment_authorize" method="POST">
  <table class="ui sortable celled table">
    <thead>
      <tr>
	<th>Short Name</th>
	<th>Full Name</th>
	<th>Roster</th>
      </tr>
    </thead>
    <tbody>
     {% for row in experiments %}
      <tr>
	<td>{{row.experiment}}</td>
	<td>{{row.name}}</td>
	<td>
	  <div class="ui labeled button" onclick="pop_experiment_users_modal('{{row.name}}')">
	    <div class="ui teal mini button">
	      <i class="user icon"></i>
	      <i class="user icon"></i>
	    </div>
	  </div>
	</td>
      </tr>
     {% endfor %}
    </tbody>
    <tfoot>
      <tr>
	<th colspan="4">
	  <input id="exp_btn_submit" type="button" class="ui {{ 'disabled' if (not current_experimenter.is_root()) }} teal button" value="Submit"
                 onclick="pop_confirm_modal()">
	</th>
      </tr>
    </tfoot>
  </table>
</form>

<div class="ui modal" id="confirm_modal">
  <i class="close icon"></i>
  <div class="header">
    Delete Experiment
  </div>
  <div class="image content">
    <div class="image">
      <i class="delete icon"></i>
    </div>
    <div class="description">
      <div class="ui header">You want to delete the selected experiments?</div>
    </div>
  </div>
  <div class="actions">
    <div class="two fluid ui buttons">
      <button class="ui red deny button">
	No
      </button>
      <button id="approved_btn" class="ui positive right labeled icon button" onclick="submit_exp_form()">
	<i class="checkmark icon"></i>
	Yes
      </button>
    </div>
  </div>
</div> <!-- Ends Modal -->

<div class="ui modal" id="add_experiment_modal">
  <i class="close icon"></i>
  <div class="header">
    Add Experiment
  </div>
  <form id="add_form" class="ui form" action="experiment_authorize" method="POST">
    <div class="two fields">
      <div class="field">
	<label></label>
	<input type="text" name="experiment" placeholder="Short Name (max: 10 char)" maxlength="10">
      </div>
      <div class="field">
	<label></label>
	<input type="text" name="name" placeholder="Full Name">
      </div>
    </div>
    <input type="submit" class="ui teal button" value="Submit">
    <div class="ui hidden divider"></div>
  </form>
</div> <!-- Ends Modal -->

<div class="ui modal" id="experiment_users_modal">
  <i class="close icon"></i>
  <div id="header_experiment_users_modal" class="header">
    Set me!
  </div>
  <table class="ui celled table">
    <thead>
      <tr>
	<th>First Name</th>
	<th>Last Name</th>
	<th>Username</th>
	<th>Active</th>
      </tr>
    </thead>
    <tbody id="table_row_experiment_users_modal">
	<tr>
	  <td>Joe</td>
	  <td>Bob's</td>
	  <td>Fishing and Bait</td>
	  <td>Emporium</td>
	</tr>
    </tbody>
  </table>
  <div class="ui hidden divider"></div>
</div> <!-- Ends Modal -->

<script>
$('.ui.form')
  .form({
    fields: {
      experiment : ['maxLength[10]', 'empty'],
      name     : 'empty'
    }
  })
;

$(document).ready(function(){
  if ("{{ message }}" != "None") {
    $("#poms_message_data").text("{{ message }}");
    $("#display_message_modal").modal('show');
  }
});


</script>

{%endblock%}
