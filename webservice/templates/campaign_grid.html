{%extends "layout.html"%}

{%block title%}
    <title>POMS:Active Campaigns</title>
{%endblock%}


{%block breadcrumbs%}
<div class="ui breadcrumb" style="margin-top: -45px;">
  <a href="{{pomspath}}/" class="section">Home</a>
  <div class="divider"> / </div>
  <div class="section">Campaigns</div>
</div>
{%endblock%}


{%block header%}
<h1 class="ui header">
     Campaigns{%include 'help_button.html'%}
</h1>
{%endblock%}




{%block subheader%}
<h2 class="ui dividing header">Active Campaigns <!--for {{time_range_string}}--></h2>
<a href="{{prev}}">&lt;previous {{days}} days</a> | 
<a href="{{next}}">next {{days}} days &gt;</a>

<div class="ui basic label">
  <i class="wait icon"></i>  <div class="tmin" style="display:inline;"></div> to <div class="tmax" style="display:inline;"></div>
</div>

{%endblock%}




{%block content%}

<!--
 {{counts}}
 {{counts_keys}}
-->

  <div class="ui">


   <table class="ui celled table unstackable">
     <tr>
       <th colspan=3> Campaign 
        <a target="_help" href="https://cdcvs.fnal.gov/redmine/projects/prod_mgmt_db/wiki/Glossary#Campaign"><i style="float: none" class="grey help circle link icon"></i></a>
      </th>
      <th colspan=3>Active Jobs </th>
      <th colspan=2>Jobs in {{time_range_string}}</th>
     </tr>
     <tr>
        <th>Actions </th>
        <th>Experiment </th>
        <th>Name </th>
        <th>Idle 
          <a target="_blank" href="https://cdcvs.fnal.gov/redmine/projects/prod_mgmt_db/wiki/Glossary#Job"><i style="float: none" class="grey help circle link icon"></i></a>
        </th>
        <th>Running
        <a target="_blank" href="https://cdcvs.fnal.gov/redmine/projects/prod_mgmt_db/wiki/Glossary#Job"><i style="float: none" class="grey help circle link icon"></i></a>
        </th>
        <th>Held
          <a target="_blank" href="https://cdcvs.fnal.gov/redmine/projects/prod_mgmt_db/wiki/Glossary#Job"><i style="float: none" class="grey help circle link icon"></i></a>
        </th>
        <th>Completed
          <a target="_blank" href="https://cdcvs.fnal.gov/redmine/projects/prod_mgmt_db/wiki/Glossary#Job"><i style="float: none" class="grey help circle link icon"></i></a>
        </th>
        <th>Located
          <a target="_blank" href="https://cdcvs.fnal.gov/redmine/projects/prod_mgmt_db/wiki/Glossary#Job"><i style="float: none" class="grey help circle link icon"></i></a>
        </th>
        <th>Removed
          <a target="_blank" href="https://cdcvs.fnal.gov/redmine/projects/prod_mgmt_db/wiki/Glossary#Job"><i style="float: none" class="grey help circle link icon"></i></a>
        </th>
     </tr>

     {% for c in cl %}
            <tr>
            <td>
            <a href="{{pomspath}}/campaign_sheet?campaign_id={{c.campaign_id}}&tmax={{tmaxs}}"><i class="external table icon" data-content="Campaign Spreadsheet" data-variation="basic"></i></a>
            <a href="{{pomspath}}/campaign_time_bars?campaign_id={{c.campaign_id}}&tmin={{tmins}}&tmax={{tmaxs}}"><i class="external tasks icon" data-content="Tasks in Campaign Time Bars" data-variation="basic"></i></a>
            <a href="{{pomspath}}/pending_files?campaign_id={{c.campaign_id}}"><i class="external file icon" data-content="Pending File Information" data-variation="basic"></i></a>
            <a href="{{pomspath}}/campaign_info?campaign_id={{c.campaign_id}}"><i class="external info circle icon" data-content="Campaign Information" data-variation="basic"></i></a>
            <a target="_blank" href="{{pomspath}}/launch_jobs?campaign_id={{c.campaign_id}}"><i class="external rocket icon" data-content="Launch Tasks for Campaign" data-variation="basic"></i></a>
            <a target="_blank" href="{{pomspath}}/kill_jobs?campaign_id={{c.campaign_id}}"><i class="external trash icon" data-content="Kill jobs in Campaign" data-variation="basic"></i></a>
            </td>
            <td>{{c.experiment}}</td>
            <td>{{c.name}}</td>
            {% for k in counts_keys[c.campaign_id] %}
              {% if k %}
                <td>
                  <a href="job_table?campaign_id={{c.campaign_id}}&job_status={{k}}&tmin={{tmins}}&tmax={{tmaxs}}&tdays={{tdays}}">
                    {{counts[c.campaign_id][k]}}
                  </a>
                 </td>
               {%endif%}
            {% endfor %}
         </tr>

     {% endfor %}

    </table>
  </div>

<script>
var tmin_local_time = moment.utc('{{tmin}}').toDate();
tmin_local_time = moment(tmin_local_time).format('YYYY-MM-DD HH:mm');
$( ".tmin" ).html( tmin_local_time );

var tmax_local_time = moment.utc('{{tmax}}').toDate();
tmax_local_time = moment(tmax_local_time).format('YYYY-MM-DD HH:mm');
$( ".tmax" ).html( tmax_local_time );
</script>



<script>
$('.external')
  .popup({
    inline   : true,
    hoverable: true,
    delay: {
      show: 300,
      hide: 80
    }
  })
;
</script>


<script>
$(function() {
    $('#global_datepicker_container').show();
});
</script>

{%endblock%}
