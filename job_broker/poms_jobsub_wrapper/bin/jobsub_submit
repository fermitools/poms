#!/bin/sh

#
# wrapper to intercept calls to jobsub_client
#
# expects POMS_CAMPAIGN_ID in the environment
#
POMS_URI=${POMS_URI:-"http://pomsgpvm01.fnal.gov:8080/poms"}

POMS_CAMPAIGN_ID=${POMS_CAMPAIGN_ID:-14}

extra=""

if [ "x$GROUP" != "x" ]
then
    extra="$extra --experiemnt $GROUP"
fi

if [ "x$POMS_PARENT_TASK_ID" != "x" ]
then
   extra="$extra --parent-task-id=$POMS_PARENT_TASK_ID"
fi

result=`get_task_for_campaign --command="jobsub_submit $*" $POMS_CAMPAIGN_ID $extra`

export POMS_TASK_ID=`echo "$result" | sed -e 's/.*=//'`

echo "task_url='https://pomsgpvm01.fnal.gov/poms/show_task_jobs?task_id=$POMS_TASK_ID'"

$JOBSUB_CLIENT_DIR/jobsub_submit -e POMS_TASK_ID -e POMS_PARENT_TASK_ID "$@"
